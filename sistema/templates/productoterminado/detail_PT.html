{%extends "base.html"%}
{%block title%} Detalle Producto Terminado {%endblock%}


{%block content%}

      <a href="{% url 'produ_app:list_produ' %}" style="color: rgb(236, 225, 47, .75)"><i class="fa-solid fa-arrow-left fa-2xl"></i></a>

      <div class="mt-3 row">

        <!--Tarjeta de los detalles de materia prima-->
        <div class="col-sm-6 mb-3 mb-sm-0">
          <div class="card">
            <div class="card-header">
              <h5>Detalles Materia Prima</h5>
            </div>

            <div class="card-body">
              <p class="card-text">Lote: {{ productoterminado.pt_lote }} | {{productoterminado.pt_nombre}}</p>
              <p class="card-text">Cantidad: {{ productoterminado.pt_cantidad }} g </p>
              <p class="card-text">Fecha de Preparación: {{productoterminado.pt_fechapreparacion}}</p>
              <p class="card-text">Fecha de Vencimiento: {{productoterminado.pt_fechavencimiento}}</p>
            </div>
          </div>
        </div>


      <div class="mt-3 row">
        <!--Tarjeta de Caracteristicas Organolepticas-->
        <div class="col-sm-6 mb-3 mb-sm-0">
          <div class="card">
            <div class="card-header">
              Características Organolépticas
            </div>

            <div class="card-body">
              <!-- Verificar si ya existen características organolépticas -->
              {% if productoterminado.caracteristicasorganolepticas_set.all %}
              <!-- Si ya existen, mostrar un mensaje o desactivar el enlace/botón para ingresar nuevas características -->
              <div class="alert alert-warning" role="alert">
                  Ya se han registrado características organolépticas para este producto terminado.                  
              </div>
              {% else %}
                <div class="alert alert-warning" role="alert">
                  No se han registrado características organolépticas para este producto terminado.                  
                </div>
              {% endif %}
              <p class="card-text">
                {% for c in productoterminado.caracteristicasorganolepticas_set.all %}
                  {% if c.estado == '1' %}
                    <div class="row">
                      <div class="col-6">Estado: <p style="color: red;">{{ c.get_estado_display }}</p>
                      <p>Caracerísticas NO Satisfactorias:</p>
                      <ul>
                        {% if not c.olor %}<li>Olor</li>{% endif %}
                        {% if not c.sabor %}<li>Sabor</li>{% endif %}
                        {% if not c.textura %}<li>Textuara</li>{% endif %}
                        {% if not c.color %}<li>Color</li>{% endif %}
                      </ul>
                        
                      </div>
                      <div class="col-6 d-flex justify-content-center align-items-center"><a onclick="caracteristicas_update('{% url 'produ_app:updateCaracteristicas_pt' c.pk %}')" class="btn btn-warning" type="button"><i class="fa-regular fa-circle-check"></i> Editar</a></div>
                    </div>
                  {% else %}
                    <div class="row">
                      <div class="col-6">Estado: <p style="color: green;">{{ c.get_estado_display }}</p></div>
                      <div class="col-6 d-flex justify-content-center align-items-center"><a onclick="caracteristicas_update('{% url 'produ_app:updateCaracteristicas_pt' c.pk %}')" class="btn btn-warning" type="button"><i class="fa-regular fa-circle-check"></i> Editar</a></div>
                    </div>
 
                  {% endif %}
                {% endfor %}
              </p>
            </div>
          </div>
        </div>

        <!--Tarjeta de Empaque-->
        <div class="col-sm-6">
          <div class="card">
            <div class="card-header">
              Empaque
            </div>

            <div class="card-body">
              <!-- Verificar si el producto esta empacado -->
              {% if productoterminado.EmpaqueProductoTerminado_set.all %}
              <!-- Si ya existen, mostrar un mensaje o desactivar el enlace/botón para ingresar nuevas características -->
              <div class="alert alert-info" role="alert">
                {% for d in productoterminado.EmpaqueProductoTerminado_set.all %}
                  <p class="card-text">Lote: {{d.pt_lote}}</p>
                  <p class="card-text">Peso: {{d.emp_pesoKg}}%</p>
                  <p class="card-text">Cantidad Bolsas: {{d.emp_cantidadBolsas}}</p>
                  <a onclick="empaque_update('{% url 'produ_app:empaque_update' d.id %}')" class="btn btn-info" type="button"><i class="fa-solid fa-pump-soap"></i> Editar</a></div>
                {% endfor %}
              </div>
              {% else %}
              <div class="alert alert-warning" role="alert">
                No se han registrado bolsas empacadas de producto terminado.                  
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
  
      
      <div class="modal fade" id="caracteristicas_update" role="dialog"></div>
      <div class="modal fade" id="empaque_update" role="dialog"></div>
      

{%endblock%}


{% block extrajs %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
  

    function caracteristicas_update(url){
        var $ = jQuery.noConflict();
        $('#caracteristicas_update').load(url,function(){
            $(this).modal('show');
        }); 
    } 

    function empaque_update(url){
        var $ = jQuery.noConflict();
        $('#empaque_update').load(url,function(){
            $(this).modal('show');
        }); 
    }
</script>
{% endblock %}
  